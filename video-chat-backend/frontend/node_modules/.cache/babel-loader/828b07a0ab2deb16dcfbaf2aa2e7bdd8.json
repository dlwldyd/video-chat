{"ast":null,"code":"import _regeneratorRuntime from\"/home/dlwldyd/project/video_chat/video-chat-backend/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/dlwldyd/project/video_chat/video-chat-backend/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/home/dlwldyd/project/video_chat/video-chat-backend/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/home/dlwldyd/project/video_chat/video-chat-backend/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/home/dlwldyd/project/video_chat/video-chat-backend/frontend/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject10,_templateObject11;import React,{useEffect,useRef,useState}from\"react\";import styled from\"styled-components\";import SockJS from\"sockjs-client\";import Stomp from\"stompjs\";import{FaRegPaperPlane}from\"react-icons/fa\";import{useLocation,useNavigate}from\"react-router\";import axios from\"axios\";import handleAxiosException from\"../exception/handleAxiosException\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var InputPanel=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n    position: sticky;\\n    left: 0;\\n    right: 0;\\n    bottom: 0;\\n    height: 60px;    \\n    background-color: \",\";\\n    border-top: 2px solid #e6d5d5;\\n    padding-left: 20px;\\n    padding-right: 20px;\\n    display: flex;\\n    align-items: center;\\n    justify-content: space-between;\\n    flex-shrink: 0;\\n\"])),function(props){return props.theme.color.bgColor;});var InputBox=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n    height: 50px;\\n    background-color: \",\";\\n    display: flex;\\n    padding: 0px 10px;\\n    align-items: center;\\n    flex-grow: 1;\\n    font-size: 15px;\\n    &:hover {\\n        cursor: text;\\n    }\\n\"])),function(props){return props.theme.color.bgColor;});var InputChat=styled.textarea(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n    resize: none;\\n    width: 100%;\\n    color: \",\";\\n    background-color: \",\";\\n    border: none;\\n    overflow: hidden;\\n    vertical-align: middle;\\n    font-size: inherit;\\n    border-bottom: 1px solid \",\";\\n    &:focus {\\n        outline: none;\\n        border-bottom: 2px solid \",\";\\n    }\\n\"])),function(props){return props.theme.color.textColor;},function(props){return props.theme.color.bgColor;},function(props){return props.theme.color.borderColor;},function(props){return props.theme.color.borderColor;});var SendChatBtn=styled.button(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n    height: 40px;\\n    width: 40px;\\n    margin-left: 10px;\\n    background-color: \",\";\\n    color: \",\";\\n    border-radius: 50%;\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n    border: none;\\n    &:active {\\n        background-color: \",\";\\n    }\\n    &:not(:active) {\\n        transition: background-color 0.3s ease-out;\\n    }\\n\"])),function(props){return props.theme.color.bgColor;},function(props){return props.theme.color.textColor;},function(props){return props.theme.color.clickColor;});var MessageBox=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n    margin-left: 15px;\\n    height: 30px;\\n    display: flex;\\n    align-items: center;\\n\"])));var Message=styled.span(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n    font-family: \",\";\\n    color: \",\";\\n    font-size: 14px;\\n\"])),function(props){return props.theme.font;},function(props){return props.theme.color.textColor;});var ChatLog=styled.div(_templateObject7||(_templateObject7=_taggedTemplateLiteral([\"\\n    overflow: auto;    \\n\"])));var Video=styled.video.attrs({autoPlay:true,playsInline:true,width:640,height:320})(_templateObject8||(_templateObject8=_taggedTemplateLiteral([\"\\n    width: 100%;\\n    height: 100%;\\n\"])));var Msg=styled.div(_templateObject9||(_templateObject9=_taggedTemplateLiteral([\"\\n    position: fixed;\\n    right: 0;\\n    top: 0;\\n    bottom: 0;\\n    border-left: 4px solid #e6d5d5;\\n    width: 460px;\\n    height: 100vh;\\n    display: flex;\\n    flex-direction: column;\\n    justify-content: space-between;\\n    background-color: whitesmoke;\\n\"])));var VideoGrid=styled.div(_templateObject10||(_templateObject10=_taggedTemplateLiteral([\"\\n    height: 980px;\\n    width: 1400px;\\n    justify-content: center;\\n    display: grid;\\n    grid-template-columns: repeat(3, 400px);\\n    grid-auto-rows: 320px;\\n    gap: 3px;\\n    padding-right: 460px;\\n    padding-top: 10px;\\n\"])));var Stream=styled.div(_templateObject11||(_templateObject11=_taggedTemplateLiteral([\"\\n    background-color: black;\\n\"])));function VideoChat(){var videoEl=useRef(null);var _useLocation=useLocation(),roomKey=_useLocation.state;var stomp=useRef();var inputChat=useRef(null);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),receivedMsg=_useState2[0],setReceivedMsg=_useState2[1];var _useState3=useState(new Map()),_useState4=_slicedToArray(_useState3,2),remoteStreams=_useState4[0],setRemoteStreams=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),remoteVideos=_useState6[0],setRemoteVideos=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),msg=_useState8[0],setMsg=_useState8[1];var chatLog=useRef(null);var localStream=useRef();var nickname=sessionStorage.getItem(\"nickname\");var navigate=useNavigate();useEffect(function(){var from=sessionStorage.getItem(\"username\");var myPeerConnections=new Map();var peerConnectionConfig={'iceServers':[{'urls':'stun:stun.stunprotocol.org:3478'},{'urls':'stun:stun.l.google.com:19302'}]};var uuid=function uuid(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==='x'?r:r&0x3|0x8;return v.toString(16);});};var handleStompConnection=function handleStompConnection(){var _sessionId=uuid();var ws=new SockJS(\"http://localhost:8080/stomp\",[],{sessionId:function sessionId(){return _sessionId;}});stomp.current=Stomp.over(ws);stomp.current.connect({},function(){var _stomp$current;enterRoom(_sessionId);(_stomp$current=stomp.current)===null||_stomp$current===void 0?void 0:_stomp$current.subscribe(\"/exchange/chat.exchange/room.\".concat(roomKey),function(message){var json=JSON.parse(message.body);if(json.type===\"message\"){setReceivedMsg(function(receivedMsg){return[].concat(_toConsumableArray(receivedMsg),[\"\".concat(json.nickname,\" : \").concat(json.msg)]);});}else if(json.type===\"join\"){if(json.from!==from){setRemoteStreams(function(remoteStreams){var updated=new Map(remoteStreams);updated.set(json.streamId,null);return updated;});makeOffer(json.from);}}else if(json.type===\"offer\"){if(from===json.target){setRemoteStreams(function(remoteStreams){var updated=new Map(remoteStreams);updated.set(json.streamId,null);return updated;});makeAnswer(json.from,json.sdp);}}else if(json.type===\"answer\"){if(from===json.target){var _myPeerConnections$ge;(_myPeerConnections$ge=myPeerConnections.get(json.from))===null||_myPeerConnections$ge===void 0?void 0:_myPeerConnections$ge.setRemoteDescription(json.sdp);}}else if(json.type===\"ice\"){if(from===json.target){var _myPeerConnections$ge2;(_myPeerConnections$ge2=myPeerConnections.get(json.from))===null||_myPeerConnections$ge2===void 0?void 0:_myPeerConnections$ge2.addIceCandidate(json.iceCandidate);}}else if(json.type===\"leave\"){var myPeerConnection=myPeerConnections.get(json.from);if(myPeerConnection){disconnect(myPeerConnection);}setRemoteStreams(function(remoteStreams){var updated=new Map(remoteStreams);updated.delete(json.streamId);return updated;});}});});};var enterRoom=function enterRoom(sessionId){try{axios.post(\"http://localhost:8080/api/joinRoom\",{roomKey:roomKey,sessionId:sessionId},{withCredentials:true});}catch(err){handleAxiosException(err);navigate(\"/\");}};var videoConn=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _stomp$current2,_stomp$current3;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:handleStompConnection();_context.prev=1;if(videoEl.current){_context.next=6;break;}alert(\"비디오를 불러오는데 실패했습니다.\");window.location.replace(\"/\");return _context.abrupt(\"return\");case 6:_context.next=8;return navigator.mediaDevices.getUserMedia({audio:true,video:{facingMode:\"user\"}});case 8:localStream.current=_context.sent;videoEl.current.srcObject=localStream.current;(_stomp$current2=stomp.current)===null||_stomp$current2===void 0?void 0:_stomp$current2.send(\"/chat/room.\".concat(roomKey),{},JSON.stringify({type:\"join\",from:from,nickname:nickname,roomKey:roomKey,streamId:localStream.current.id}));_context.next=23;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](1);console.log(_context.t0);if(videoEl.current){_context.next=20;break;}alert(\"비디오를 불러오는데 실패했습니다.\");window.location.replace(\"/\");return _context.abrupt(\"return\");case 20:localStream.current=new MediaStream();videoEl.current.srcObject=localStream.current;(_stomp$current3=stomp.current)===null||_stomp$current3===void 0?void 0:_stomp$current3.send(\"/chat/room.\".concat(roomKey),{},JSON.stringify({type:\"join\",from:from,nickname:nickname,roomKey:roomKey,streamId:localStream.current.id}));case 23:case\"end\":return _context.stop();}}},_callee,null,[[1,13]]);}));return function videoConn(){return _ref.apply(this,arguments);};}();var makeAnswer=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(target,receivedOffer){var _stomp$current4;var newPeerConnection,answer;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:newPeerConnection=createPeerConnection(target);if(newPeerConnection){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:_context2.next=5;return newPeerConnection.setRemoteDescription(receivedOffer);case 5:_context2.next=7;return newPeerConnection.createAnswer();case 7:answer=_context2.sent;_context2.next=10;return newPeerConnection.setLocalDescription(answer);case 10:(_stomp$current4=stomp.current)===null||_stomp$current4===void 0?void 0:_stomp$current4.send(\"/chat/room.\".concat(roomKey),{},JSON.stringify({type:\"answer\",from:from,target:target,sdp:newPeerConnection.localDescription}));case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function makeAnswer(_x,_x2){return _ref2.apply(this,arguments);};}();var createPeerConnection=function createPeerConnection(target){if(!localStream.current){console.log(\"no media\");return null;}var newPeerConnection=new RTCPeerConnection(peerConnectionConfig);myPeerConnections.set(target,newPeerConnection);newPeerConnection.onicecandidate=function(data){var _stomp$current5;(_stomp$current5=stomp.current)===null||_stomp$current5===void 0?void 0:_stomp$current5.send(\"/chat/room.\".concat(roomKey),{},JSON.stringify({type:\"ice\",from:from,target:target,iceCandidate:data.candidate}));};newPeerConnection.ontrack=handleTrack;localStream.current.getTracks().forEach(function(track){if(!localStream.current){console.log(\"no media\");return;}newPeerConnection.addTrack(track,localStream.current);});return newPeerConnection;};var makeOffer=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(target){var _localStream$current;var newPeerConnection,_stomp$current6,offer;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:newPeerConnection=createPeerConnection(target);if(newPeerConnection){_context4.next=3;break;}return _context4.abrupt(\"return\");case 3:if(!(((_localStream$current=localStream.current)===null||_localStream$current===void 0?void 0:_localStream$current.getTracks().length)===0)){_context4.next=12;break;}_context4.next=6;return newPeerConnection.createOffer({offerToReceiveAudio:true,offerToReceiveVideo:true});case 6:offer=_context4.sent;_context4.next=9;return newPeerConnection.setLocalDescription(offer);case 9:(_stomp$current6=stomp.current)===null||_stomp$current6===void 0?void 0:_stomp$current6.send(\"/chat/room.\".concat(roomKey),{},JSON.stringify({type:\"offer\",from:from,target:target,streamId:localStream.current.id,sdp:newPeerConnection.localDescription}));_context4.next=13;break;case 12:newPeerConnection.onnegotiationneeded=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var _stomp$current7,_localStream$current2;var offer;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return newPeerConnection.createOffer();case 2:offer=_context3.sent;_context3.next=5;return newPeerConnection.setLocalDescription(offer);case 5:(_stomp$current7=stomp.current)===null||_stomp$current7===void 0?void 0:_stomp$current7.send(\"/chat/room.\".concat(roomKey),{},JSON.stringify({type:\"offer\",from:from,target:target,streamId:(_localStream$current2=localStream.current)===null||_localStream$current2===void 0?void 0:_localStream$current2.id,sdp:newPeerConnection.localDescription}));case 6:case\"end\":return _context3.stop();}}},_callee3);}));case 13:case\"end\":return _context4.stop();}}},_callee4);}));return function makeOffer(_x3){return _ref3.apply(this,arguments);};}();var handleTrack=function handleTrack(data){setRemoteStreams(function(remoteStreams){var updated=new Map(remoteStreams);updated.set(data.streams[0].id,data.streams[0]);return updated;});};var disconnect=function disconnect(peerConnection){peerConnection.onicecandidate=null;peerConnection.ontrack=null;peerConnection.onnegotiationneeded=null;peerConnection.close();};var leave=function leave(){var _stomp$current8;(_stomp$current8=stomp.current)===null||_stomp$current8===void 0?void 0:_stomp$current8.disconnect(function(){var _localStream$current3;myPeerConnections.forEach(function(myPeerConnection){return disconnect(myPeerConnection);});(_localStream$current3=localStream.current)===null||_localStream$current3===void 0?void 0:_localStream$current3.getTracks().forEach(function(track){track.stop();});});};videoConn();return leave;},[roomKey,nickname,navigate]);useEffect(function(){if(chatLog.current){chatLog.current.scrollTop=chatLog.current.scrollHeight;}},[receivedMsg]);useEffect(function(){setRemoteVideos(function(remoteVideos){return Array.from(remoteStreams.values()).map(function(remoteStream,idx){return/*#__PURE__*/_jsx(Stream,{children:/*#__PURE__*/_jsx(Video,{ref:function ref(video){if(video){video.srcObject=remoteStream;}}})},idx);});});},[remoteStreams]);var onEnter=function onEnter(event){if(event.key===\"Enter\"){var _stomp$current9;event.preventDefault();(_stomp$current9=stomp.current)===null||_stomp$current9===void 0?void 0:_stomp$current9.send(\"/chat/room.\".concat(roomKey),{},JSON.stringify({type:\"message\",nickname:nickname,msg:msg}));setMsg(\"\");}};var onChange=function onChange(event){setMsg(function(msg){return event.target.value;});};var onBtnClick=function onBtnClick(){var _stomp$current10;(_stomp$current10=stomp.current)===null||_stomp$current10===void 0?void 0:_stomp$current10.send(\"/chat/room.\".concat(roomKey),{},JSON.stringify({type:\"message\",nickname:nickname,msg:msg}));setMsg(\"\");};var onInputBoxClick=function onInputBoxClick(){var _inputChat$current;(_inputChat$current=inputChat.current)===null||_inputChat$current===void 0?void 0:_inputChat$current.focus();};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(VideoGrid,{children:[/*#__PURE__*/_jsx(Stream,{children:/*#__PURE__*/_jsx(Video,{ref:videoEl})}),remoteVideos]}),/*#__PURE__*/_jsxs(Msg,{children:[/*#__PURE__*/_jsx(ChatLog,{ref:chatLog,children:receivedMsg.map(function(msg,idx){return/*#__PURE__*/_jsx(MessageBox,{children:/*#__PURE__*/_jsx(Message,{children:msg})},idx);})}),/*#__PURE__*/_jsxs(InputPanel,{children:[/*#__PURE__*/_jsx(InputBox,{onClick:onInputBoxClick,children:/*#__PURE__*/_jsx(InputChat,{rows:1,placeholder:\"\\uBA54\\uC138\\uC9C0\\uB97C \\uC785\\uB825\\uD574 \\uC8FC\\uC138\\uC694\",maxLength:100,required:true,onKeyDown:onEnter,onChange:onChange,value:msg,ref:inputChat})}),/*#__PURE__*/_jsx(SendChatBtn,{onClick:onBtnClick,children:/*#__PURE__*/_jsx(FaRegPaperPlane,{})})]})]})]});}export default VideoChat;","map":{"version":3,"names":["React","useEffect","useRef","useState","styled","SockJS","Stomp","FaRegPaperPlane","useLocation","useNavigate","axios","handleAxiosException","InputPanel","div","props","theme","color","bgColor","InputBox","InputChat","textarea","textColor","borderColor","SendChatBtn","button","clickColor","MessageBox","Message","span","font","ChatLog","Video","video","attrs","autoPlay","playsInline","width","height","Msg","VideoGrid","Stream","VideoChat","videoEl","roomKey","state","stomp","inputChat","receivedMsg","setReceivedMsg","Map","remoteStreams","setRemoteStreams","remoteVideos","setRemoteVideos","msg","setMsg","chatLog","localStream","nickname","sessionStorage","getItem","navigate","from","myPeerConnections","peerConnectionConfig","uuid","replace","c","r","Math","random","v","toString","handleStompConnection","sessionId","ws","current","over","connect","enterRoom","subscribe","message","json","JSON","parse","body","type","updated","set","streamId","makeOffer","target","makeAnswer","sdp","get","setRemoteDescription","addIceCandidate","iceCandidate","myPeerConnection","disconnect","delete","post","withCredentials","err","videoConn","alert","window","location","navigator","mediaDevices","getUserMedia","audio","facingMode","srcObject","send","stringify","id","console","log","MediaStream","receivedOffer","newPeerConnection","createPeerConnection","createAnswer","answer","setLocalDescription","localDescription","RTCPeerConnection","onicecandidate","data","candidate","ontrack","handleTrack","getTracks","forEach","track","addTrack","length","createOffer","offerToReceiveAudio","offerToReceiveVideo","offer","onnegotiationneeded","streams","peerConnection","close","leave","stop","scrollTop","scrollHeight","Array","values","map","remoteStream","idx","onEnter","event","key","preventDefault","onChange","value","onBtnClick","onInputBoxClick","focus"],"sources":["/home/dlwldyd/project/video_chat/video-chat-backend/frontend/src/chatRoom/VideoChat.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport SockJS from \"sockjs-client\";\nimport Stomp from \"stompjs\";\nimport { FaRegPaperPlane } from \"react-icons/fa\";\nimport { useLocation, useNavigate } from \"react-router\";\nimport axios, { AxiosError } from \"axios\";\nimport handleAxiosException from \"../exception/handleAxiosException\";\n\nconst InputPanel = styled.div`\n    position: sticky;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    height: 60px;    \n    background-color: ${props => props.theme.color.bgColor};\n    border-top: 2px solid #e6d5d5;\n    padding-left: 20px;\n    padding-right: 20px;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    flex-shrink: 0;\n`\n\nconst InputBox = styled.div`\n    height: 50px;\n    background-color: ${props => props.theme.color.bgColor};\n    display: flex;\n    padding: 0px 10px;\n    align-items: center;\n    flex-grow: 1;\n    font-size: 15px;\n    &:hover {\n        cursor: text;\n    }\n`\n\nconst InputChat = styled.textarea`\n    resize: none;\n    width: 100%;\n    color: ${props => props.theme.color.textColor};\n    background-color: ${props => props.theme.color.bgColor};\n    border: none;\n    overflow: hidden;\n    vertical-align: middle;\n    font-size: inherit;\n    border-bottom: 1px solid ${props => props.theme.color.borderColor};\n    &:focus {\n        outline: none;\n        border-bottom: 2px solid ${props => props.theme.color.borderColor};\n    }\n`\n\nconst SendChatBtn = styled.button`\n    height: 40px;\n    width: 40px;\n    margin-left: 10px;\n    background-color: ${props => props.theme.color.bgColor};\n    color: ${props => props.theme.color.textColor};\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border: none;\n    &:active {\n        background-color: ${props => props.theme.color.clickColor};\n    }\n    &:not(:active) {\n        transition: background-color 0.3s ease-out;\n    }\n`\n\nconst MessageBox = styled.div`\n    margin-left: 15px;\n    height: 30px;\n    display: flex;\n    align-items: center;\n`\n\nconst Message = styled.span`\n    font-family: ${props => props.theme.font};\n    color: ${props => props.theme.color.textColor};\n    font-size: 14px;\n`\n\nconst ChatLog = styled.div`\n    overflow: auto;    \n`\n\nconst Video = styled.video.attrs({autoPlay: true, playsInline: true, width: 640, height: 320})`\n    width: 100%;\n    height: 100%;\n`\n\nconst Msg = styled.div`\n    position: fixed;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    border-left: 4px solid #e6d5d5;\n    width: 460px;\n    height: 100vh;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    background-color: whitesmoke;\n`\n\nconst VideoGrid = styled.div`\n    height: 980px;\n    width: 1400px;\n    justify-content: center;\n    display: grid;\n    grid-template-columns: repeat(3, 400px);\n    grid-auto-rows: 320px;\n    gap: 3px;\n    padding-right: 460px;\n    padding-top: 10px;\n`\n\nconst Stream = styled.div`\n    background-color: black;\n`\n\nfunction VideoChat() {\n\n    const videoEl = useRef<HTMLVideoElement>(null);\n\n    const {state: roomKey} = useLocation();\n\n    const stomp = useRef<Stomp.Client>();\n    \n    const inputChat = useRef<HTMLTextAreaElement>(null);\n    \n    const [receivedMsg, setReceivedMsg] = useState<string[]>([]);\n\n    const [remoteStreams, setRemoteStreams] = useState<Map<string, MediaStream | null>>(new Map<string, MediaStream | null>());\n\n    const [remoteVideos, setRemoteVideos] = useState<JSX.Element[]>([]);\n    \n    const [msg, setMsg] = useState(\"\");\n\n    const chatLog = useRef<HTMLDivElement>(null);\n\n    const localStream = useRef<MediaStream>();\n\n    const nickname = sessionStorage.getItem(\"nickname\");\n\n    const navigate = useNavigate();\n\n    useEffect(() => {\n\n        const from = sessionStorage.getItem(\"username\");\n\n        const myPeerConnections = new Map<string, RTCPeerConnection>();\n\n        const peerConnectionConfig = {\n            'iceServers': [\n                {'urls': 'stun:stun.stunprotocol.org:3478'},\n                {'urls': 'stun:stun.l.google.com:19302'},\n            ]\n        };\n\n        const uuid = () => {\n            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n                var r = Math.random() * 16 | 0, v = c === 'x' ? r : ((r & 0x3) | 0x8);\n                return v.toString(16);\n            });\n        }\n            \n        const handleStompConnection = () => {\n            const sessionId = uuid();\n            const ws = new SockJS(\"http://localhost:8080/stomp\", [], {\n                sessionId: () => {\n                    return sessionId;\n                },\n            });\n            stomp.current = Stomp.over(ws);\n            stomp.current.connect({}, () => {\n                enterRoom(sessionId);\n                stomp.current?.subscribe(`/exchange/chat.exchange/room.${roomKey}`, (message) => {\n                    const json = JSON.parse(message.body);\n                    if(json.type === \"message\") {\n                        setReceivedMsg(receivedMsg => [...receivedMsg, `${json.nickname} : ${json.msg}`]);\n                    } else if(json.type === \"join\") {\n                        if(json.from !== from) {\n                            setRemoteStreams(remoteStreams => {\n                                const updated = new Map<string, MediaStream | null>(remoteStreams);\n                                updated.set(json.streamId, null);\n                                return updated;\n                            });\n                            makeOffer(json.from);\n                        }\n                    } else if(json.type === \"offer\") {\n                        if(from === json.target) {\n                            setRemoteStreams(remoteStreams => {\n                                const updated = new Map<string, MediaStream | null>(remoteStreams);\n                                updated.set(json.streamId, null);\n                                return updated;\n                            });\n                            makeAnswer(json.from, json.sdp);\n                        }\n                    } else if(json.type === \"answer\") {\n                        if(from === json.target) {\n                            myPeerConnections.get(json.from)?.setRemoteDescription(json.sdp);\n                        }\n                    } else if(json.type === \"ice\") {\n                        if(from === json.target) {\n                            myPeerConnections.get(json.from)?.addIceCandidate(json.iceCandidate);\n                        }\n                    } else if(json.type === \"leave\") {\n                        const myPeerConnection = myPeerConnections.get(json.from);\n                        if(myPeerConnection) {\n                            disconnect(myPeerConnection);\n                        }\n                        setRemoteStreams(remoteStreams => {\n                            const updated = new Map<string, MediaStream | null>(remoteStreams);\n                            updated.delete(json.streamId);\n                            return updated;\n                        })\n                    }\n                });\n            })\n        };\n    \n\n        const enterRoom = (sessionId: string) => {\n            try {\n                axios.post(`http://localhost:8080/api/joinRoom`, {\n                    roomKey,\n                    sessionId,\n                }, {\n                    withCredentials: true,\n                });\n            } catch(err: unknown | AxiosError) {\n                handleAxiosException(err);\n                navigate(\"/\");\n            }\n        }\n\n        const videoConn = async () => {\n            handleStompConnection();\n            try{\n                if(!videoEl.current) {\n                    alert(\"비디오를 불러오는데 실패했습니다.\");\n                    window.location.replace(\"/\");\n                    return;\n                }\n                localStream.current = await navigator.mediaDevices.getUserMedia({\n                    audio: true,\n                    video: {\n                        facingMode: \"user\"\n                    },\n                });\n                videoEl.current.srcObject = localStream.current;\n                stomp.current?.send(`/chat/room.${roomKey}`, {}, JSON.stringify({type: \"join\", from, nickname, roomKey, streamId: localStream.current.id}));\n            } catch(err: any) {\n                console.log(err);\n                if(!videoEl.current) {\n                    alert(\"비디오를 불러오는데 실패했습니다.\");\n                    window.location.replace(\"/\");\n                    return;\n                }\n                localStream.current = new MediaStream();\n                videoEl.current.srcObject = localStream.current;\n                stomp.current?.send(`/chat/room.${roomKey}`, {}, JSON.stringify({type: \"join\", from, nickname, roomKey, streamId: localStream.current.id}));\n            }\n        }\n\n        const makeAnswer = async (target: string, receivedOffer: RTCSessionDescriptionInit) => {\n            const newPeerConnection = createPeerConnection(target);\n            if(!newPeerConnection) {\n                return;\n            }\n            await newPeerConnection.setRemoteDescription(receivedOffer);\n            const answer = await newPeerConnection.createAnswer();\n            await newPeerConnection.setLocalDescription(answer);\n            stomp.current?.send(`/chat/room.${roomKey}`, {}, JSON.stringify({type: \"answer\", from, target, sdp: newPeerConnection.localDescription}));\n        }\n\n        const createPeerConnection = (target: string) => {\n            if(!localStream.current) {\n                console.log(\"no media\");\n                return null;\n            }\n            const newPeerConnection = new RTCPeerConnection(peerConnectionConfig);\n            myPeerConnections.set(target, newPeerConnection);\n            newPeerConnection.onicecandidate = (data) => {\n                stomp.current?.send(`/chat/room.${roomKey}`, {}, JSON.stringify({type: \"ice\", from, target, iceCandidate: data.candidate}));\n            }\n            newPeerConnection.ontrack = handleTrack;\n            localStream.current.getTracks().forEach(track => {\n                if(!localStream.current) {\n                    console.log(\"no media\");\n                    return;\n                }\n                newPeerConnection.addTrack(track, localStream.current);\n            });\n            return newPeerConnection;\n        }\n\n        const makeOffer = async (target: string) => {\n            const newPeerConnection = createPeerConnection(target);\n            if(!newPeerConnection) {\n                return;\n            }\n            if(localStream.current?.getTracks().length === 0) {\n                const offer = await newPeerConnection.createOffer({offerToReceiveAudio: true, offerToReceiveVideo: true});\n                await newPeerConnection.setLocalDescription(offer);\n                stomp.current?.send(`/chat/room.${roomKey}`, {}, JSON.stringify({type: \"offer\", from, target, streamId: localStream.current.id, sdp: newPeerConnection.localDescription})); \n            } else {\n                newPeerConnection.onnegotiationneeded = async () => {\n                    const offer = await newPeerConnection.createOffer();\n                    await newPeerConnection.setLocalDescription(offer);\n                    stomp.current?.send(`/chat/room.${roomKey}`, {}, JSON.stringify({type: \"offer\", from, target, streamId: localStream.current?.id, sdp: newPeerConnection.localDescription})); \n                }\n            }\n        }\n\n        const handleTrack = (data: RTCTrackEvent) => {\n            setRemoteStreams(remoteStreams => {\n                const updated = new Map<string, MediaStream | null>(remoteStreams);\n                updated.set(data.streams[0].id, data.streams[0]);\n                return updated;\n            });\n        }\n\n        const disconnect = (peerConnection: RTCPeerConnection) => {\n            peerConnection.onicecandidate = null;\n            peerConnection.ontrack = null;\n            peerConnection.onnegotiationneeded = null;\n            peerConnection.close();\n        }\n\n        const leave = () => {\n            stomp.current?.disconnect(() => {\n                myPeerConnections.forEach(myPeerConnection => disconnect(myPeerConnection));\n                localStream.current?.getTracks().forEach(track => {\n                    track.stop();\n                });\n            });\n        };\n\n        videoConn();\n\n        return leave;\n\n    }, [roomKey, nickname, navigate]);\n    \n    useEffect(() => {\n        if(chatLog.current) {\n            chatLog.current.scrollTop = chatLog.current.scrollHeight;\n        }\n    }, [receivedMsg]);\n\n    useEffect(() => {\n        setRemoteVideos(remoteVideos => Array.from(remoteStreams.values()).map((remoteStream, idx) => \n            <Stream key={idx}>\n                <Video ref={video => {\n                    if(video) {\n                        video.srcObject = remoteStream;\n                    }\n                }} />\n            </Stream>\n        ))\n    }, [remoteStreams]);\n    \n    const onEnter = (event: React.KeyboardEvent<HTMLTextAreaElement>) => {\n        if(event.key === \"Enter\") {\n            event.preventDefault();\n            stomp.current?.send(`/chat/room.${roomKey}`, {}, JSON.stringify({type: \"message\", nickname, msg}));\n            setMsg(\"\");\n        }\n    }\n    \n    const onChange = (event: React.ChangeEvent<HTMLTextAreaElement>) => {\n        setMsg(msg => event.target.value);\n    }\n    \n    const onBtnClick = () => {\n        stomp.current?.send(`/chat/room.${roomKey}`, {}, JSON.stringify({type: \"message\", nickname, msg}));\n        setMsg(\"\");\n    }\n    \n    const onInputBoxClick = () => {\n        inputChat.current?.focus();\n    }\n\n    return (\n        <div>\n            <VideoGrid>\n                <Stream>\n                    <Video ref={videoEl} />\n                </Stream>\n                {remoteVideos}\n            </VideoGrid>\n            <Msg>\n                <ChatLog ref={chatLog}>\n                    {receivedMsg.map((msg, idx) => \n                    <MessageBox key={idx}>\n                        <Message>{msg}</Message>\n                    </MessageBox>)}\n                </ChatLog>\n                <InputPanel>\n                    <InputBox onClick={onInputBoxClick}>\n                        <InputChat rows={1} placeholder=\"메세지를 입력해 주세요\" maxLength={100} required onKeyDown={onEnter} onChange={onChange} value={msg} ref={inputChat}/>\n                    </InputBox>\n                    <SendChatBtn onClick={onBtnClick}><FaRegPaperPlane/></SendChatBtn>\n                </InputPanel>\n            </Msg>\n        </div>\n    );\n}\n\nexport default VideoChat;"],"mappings":"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"},"metadata":{},"sourceType":"module"}